<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web By Van Hai</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #6c5ce7;
            --success: #2ed573;
            --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        .quiz-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            text-align: center;
        }

        .question-block {
            text-align: left; background: white; padding: 20px;
            border-radius: 20px; margin-bottom: 25px; border: 1px solid #eee;
        }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .option {
            padding: 12px; border: 2px solid #f1f2f6; border-radius: 12px;
            cursor: pointer; transition: 0.3s; text-align: center; background: #fff; font-size: 14px;
        }
        .option.selected { background: var(--primary); border-color: var(--primary); color: white; }
        .option.locked { cursor: not-allowed; opacity: 0.7; }

        input[type="text"] {
            width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 12px;
            box-sizing: border-box; font-size: 16px; margin-bottom: 20px; outline: none;
        }

        #submit {
            width: 100%; padding: 18px; background: var(--primary); color: white;
            border: none; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer;
        }

        #result-screen { display: none; animation: fadeIn 0.8s ease; }
        .success-icon { font-size: 80px; color: var(--success); margin-bottom: 10px; }
        .score-text { font-size: 40px; font-weight: bold; color: #2d3436; }
        .comment-text { font-size: 22px; color: var(--primary); font-weight: 600; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="quiz-container">
    <div id="quiz-wrapper">
        <h1 style="color: var(--primary);">âœ¨ Web By Van Hai âœ¨</h1>
        <form name="ket-qua-trac-nghiem" method="POST" data-netlify="true" id="quiz-form">
            <input type="hidden" name="form-name" value="ket-qua-trac-nghiem" />
            <input type="text" name="ten_nguoi_choi" id="username" placeholder="Nháº­p tÃªn cá»§a báº¡n..." required>
            <input type="hidden" name="so_diem" id="score-input">
            <div id="quiz-content"></div>
            <button type="button" id="submit" onclick="calculateScore()">Gá»­i káº¿t quáº£ ngay ðŸš€</button>
        </form>
    </div>

    <div id="result-screen">
        <div class="success-icon">âœ“</div>
        <h2>HoÃ n thÃ nh thÃ nh cÃ´ng!</h2>
        <div id="display-score" class="score-text">0/15</div>
        <div id="comment" class="comment-text"></div>
        <p style="color: #666; margin-top: 20px;">Káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c gá»­i tá»›i chá»§ nhÃ¢n!</p>
    </div>
</div>

<script>
    // ÄÃ¡p Ã¡n Ä‘Ãºng theo yÃªu cáº§u cá»§a báº¡n (Vá»‹ trÃ­ 0, 1, 2, 3)
    const DAP_AN_CUA_TOI = [0, 3, 0, 0, 2, 0, 1, 2, 3, 0, 3, 3, 1, 3, 1]; 

    const questions = [
        { q: "MÃ¬nh thÃ­ch lÃ m gÃ¬ nháº¥t khi ráº£nh?", a: ["Xem phim", "Ngá»§", "Äi chÆ¡i", "Äá»c sÃ¡ch"] },
        { q: "Äá»“ uá»‘ng 'chÃ¢n Ã¡i' cá»§a mÃ¬nh?", a: ["CÃ  phÃª", "TrÃ  sá»¯a", "NÆ°á»›c Ã©p", "NÆ°á»›c lá»c"] },
        { q: "Gu Äƒn uá»‘ng cá»§a mÃ¬nh?", a: ["Vá»‹ Cay", "Vá»‹ Ngá»t", "Vá»‹ Chua", "Vá»‹ Máº·n"] },
        { q: "Thá»i tiáº¿t mÃ¬nh thÃ­ch nháº¥t?", a: ["Náº¯ng rÃ¡o", "Se láº¡nh", "MÆ°a bay", "Tuyáº¿t rÆ¡i"] },
        { q: "Äá»‹a Ä‘iá»ƒm mÃ¬nh muá»‘n Ä‘i nháº¥t?", a: ["ThÃ nh phá»‘", "VÃ¹ng nÃºi", "BÃ£i biá»ƒn", "Äá»“ng quÃª"] },
        { q: "MÃ¬nh ghÃ©t nháº¥t Ä‘iá»u gÃ¬?", a: ["Giáº£ dá»‘i, há»©a pháº¡m", "Trá»… háº¹n", "á»’n Ã o", "Khoe khoang"] },
        { q: "Tin nháº¯n lÃ m mÃ¬nh khÃ³ chá»‹u nháº¥t?", a: ["Cá»¥t lá»§n", "Xem Ä‘Ã©o rep", "Spam nhiá»u", "Chá»‰ gá»­i icon"] },
        { q: "Cáº£m giÃ¡c mÃ¬nh sá»£ nháº¥t?", a: ["CÃ´ Ä‘Æ¡n", "Báº­n rá»™n", "Chá» Ä‘á»£i", "GÃ² bÃ³"] },
        { q: "Äiá»u mÃ¬nh coi trá»ng nháº¥t khi yÃªu?", a: ["Tin tÆ°á»Ÿng", "Quan tÃ¢m", "ChÃ¢n thÃ nh", "Cáº£ 3 phÆ°Æ¡ng Ã¡n"] },
        { q: "MÃ¬nh ghÃ©t Ä‘iá»u gÃ¬ nháº¥t trong tÃ¬nh yÃªu?", a: ["Qua láº¡i nyc ðŸ˜’", "VÃ´ tÃ¢m", "Kiá»ƒm soÃ¡t", "Lá»«a dá»‘i"] },
        { q: "CÃ¡ch mÃ¬nh bÃ y tá» tÃ¬nh cáº£m?", a: ["Táº·ng quÃ ", "HÃ nh Ä‘á»™ng", "Lá»i nÃ³i", "Äá»¥ng cháº¡m"] },
        { q: "Gu ngÆ°á»i yÃªu cá»§a mÃ¬nh?", a: ["HÃ i hÆ°á»›c", "Láº¡nh lÃ¹ng", "Tá»­ táº¿", "Hiá»n + CÃ¡ tÃ­nh"] },
        { q: "Khi cÃ£i nhau mÃ¬nh sáº½?", a: ["Im láº·ng", "Giáº£i thÃ­ch", "KhÃ³c", "Xin lá»—i"] },
        { q: "Ná»—i sá»£ lá»›n nháº¥t khi yÃªu?", a: ["Pháº£n bá»™i", "Nháº¡t nháº½o", "Ãp lá»±c", "Nháº¡t + Chia tay"] },
        { q: "MÃ¬nh tin vÃ o Ä‘iá»u gÃ¬ nháº¥t?", a: ["DuyÃªn sá»‘", "Ná»— lá»±c", "Cáº£m xÃºc", "Váº­t cháº¥t"] }
    ];

    let userChoices = new Array(questions.length).fill(null);
    const container = document.getElementById('quiz-content');

    window.onload = () => {
        if (localStorage.getItem('quiz_done')) {
            showResultScreen(localStorage.getItem('quiz_score'));
        }
    };

    questions.forEach((item, index) => {
        const block = document.createElement('div');
        block.className = 'question-block';
        block.innerHTML = `<strong>${index + 1}. ${item.q}</strong>`;
        const optsDiv = document.createElement('div');
        optsDiv.className = 'options';
        item.a.forEach((opt, optIndex) => {
            const btn = document.createElement('div');
            btn.className = 'option';
            btn.innerText = opt;
            btn.onclick = () => {
                if (userChoices[index] !== null) return;
                userChoices[index] = optIndex;
                btn.classList.add('selected');
                Array.from(optsDiv.children).forEach(c => c.classList.add('locked'));
            };
            optsDiv.appendChild(btn);
        });
        block.appendChild(optsDiv);
        container.appendChild(block);
    });

    function calculateScore() {
        const name = document.getElementById('username').value.trim();
        if (!name) return alert("Vui lÃ²ng nháº­p tÃªn!");
        if (!userChoices.every(c => c !== null)) return alert("Vui lÃ²ng hoÃ n thÃ nh 15 cÃ¢u há»i!");

        let score = 0;
        userChoices.forEach((choice, i) => { if (choice === DAP_AN_CUA_TOI[i]) score++; });
        const finalScore = `${score}/${questions.length}`;

        localStorage.setItem('quiz_done', 'true');
        localStorage.setItem('quiz_score', finalScore);
        document.getElementById('score-input').value = finalScore;
        
        // Gá»­i Form lÃªn Netlify
        const form = document.getElementById('quiz-form');
        const formData = new FormData(form);
        fetch("/", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(formData).toString(),
        });

        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        showResultScreen(finalScore, score);
    }

    function showResultScreen(scoreStr, scoreNum) {
        if (scoreNum === undefined) scoreNum = parseInt(scoreStr.split('/')[0]);
        document.getElementById('quiz-wrapper').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('display-score').innerText = scoreStr;

        let comment = "";
        if (scoreNum < 6) comment = "Biáº¿t ngay mÃ ! ðŸ˜‚";
        else if (scoreNum >= 6 && scoreNum <= 10) comment = "Táº¡m cháº¥p nháº­n! ðŸ™„";
        else if (scoreNum > 10 && scoreNum < 15) comment = "á»ª Ä‘Æ°á»£c! ðŸ‘";
        else if (scoreNum === 15) comment = "Giá»i Ä‘áº¥y! â¤ï¸";
        document.getElementById('comment').innerText = comment;
    }
</script>
</body>
</html>
